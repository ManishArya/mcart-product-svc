apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
 name: productserver
 namespace: {{.Values.namespace  | quote}}
spec:
 hosts:
   - '*'
 gateways:
   - istio-ingress/root-gateway
 http:
 - match:
   - uri:
       prefix: /api/v1/products
   route:
   - destination:
       host: product-api-svc.amcart.svc.cluster.local
       port:
         number: 8080
   corsPolicy:
     allowOrigins:
     - exact: {{.Values.frontdoorurl | quote}}
     - exact: {{.Values.origin | quote}}
     allowMethods:
     - POST
     - GET
     - OPTIONS
     allowHeaders:
     - X-Custom-Header
     - content-type
     - authorization
     - Access-Control-Allow-Origin
     - Access-Control-Allow-Methods
     - Access-Control-Allow-Headers
     - x-azure-ref
     exposeHeaders:
     - X-Expose-Header
     maxAge: 24h
     allowCredentials: false
 